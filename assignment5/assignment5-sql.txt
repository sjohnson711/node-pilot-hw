
SELECT orders.order_id, SUM(products.price * line_items.quantity) AS total_price FROM orders JOIN line_items ON orders.order_id = line_items.order_id JOIN products ON line_items.product_id = products.product_id GROUP BY orders.order_id ORDER BY orders.order_id LIMIT 5;

#for each customer find the average total price of their orders, and return the results ordered by customer name.
SELECT c.customer_name, AVG(t.total_price) AS average_order_price FROM customers c JOIN (SELECT o.order_id, o.customer_id, SUM(p.price * li.quantity) AS total_price FROM orders o JOIN line_items li ON o.order_id = li.order_id JOIN products p ON li.product_id = p.product_id GROUP BY o.order_id, o.customer_id) AS t ON c.customer_id = t.customer_id GROUP BY c.customer_id, c.customer_name ORDER BY c.customer_name;
